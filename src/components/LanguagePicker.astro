---
import { getRelativeLocaleUrl } from "astro:i18n";
import Icon from "astro-iconify";

interface Props {
  id?: string;
}

const { id } = Astro.props;
const lang = Astro.currentLocale as "es" | "en";
const options = [
  { code: "es", label: "ES", icon: "circle-flags:es" },
  { code: "en", label: "EN", icon: "circle-flags:us" },
];
---

<div id={id} class="relative inline-block text-left picker-container group">
  <button
    type="button"
    class="picker-btn flex items-center gap-2 px-3 py-1 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-white text-sm font-medium focus-within:outline-none focus-within:ring-2 focus-within:ring-white/20"
    aria-haspopup="listbox"
    aria-expanded="false"
    aria-label="Select language"
  >
    <Icon
      name={lang === "es" ? "circle-flags:es" : "circle-flags:us"}
      class="size-5 pointer-events-none"
    />
    <span class="font-bold uppercase">{lang}</span>
    <Icon
      name="mdi:chevron-down"
      class="size-4 text-white/70 transition-transform duration-200 chevron-icon pointer-events-none"
    />
  </button>

  <ul
    class="picker-menu absolute right-0 mt-2 w-max min-w-[120px] origin-top-right rounded-xl bg-[#1a1a1a] border border-white/10 shadow-xl focus:outline-none opacity-0 scale-95 pointer-events-none transition-all duration-200 z-100 py-1 group-focus-within:opacity-100 group-focus-within:scale-100 group-focus-within:pointer-events-auto"
    role="listbox"
  >
    {
      options.map((opt) => (
        <li>
          <a
            href={getRelativeLocaleUrl(opt.code)}
            class={`flex items-center gap-3 px-4 py-2 text-sm text-gray-200 hover:bg-white/10 transition-colors ${lang === opt.code ? "bg-white/5 text-amber-500" : ""}`}
            role="option"
            aria-selected={lang === opt.code}
          >
            <Icon name={opt.icon} class="size-5" />
            <span class="font-medium">{opt.label}</span>
            {lang === opt.code && (
              <Icon name="mdi:check" class="size-4 ml-auto text-amber-500" />
            )}
          </a>
        </li>
      ))
    }
  </ul>
</div>
